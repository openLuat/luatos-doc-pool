@[TOC]

# rtk
lua.rtk rtk访问库，支持千寻RTK和星舆RTK（LuatOSVer>=3104）
## rtk_sol_mode常量

RTK解算模式

| **常量**                             | **说明**                     |
| ------------------------------------ | ---------------------------- |
| rtk.SOLMODE_SINGLE                   | 单点定位模式                 |
| rtk.SOLMODE_RTK                      | 单RTK解算模式                |
| rtk.SOLMODE_RTK_DR                   | RTK+IMU融合解算模式          |

---



## rtk_time_type常量

RTK时间类型

| **常量**                              | **说明**                    |
| ------------------------------------  | --------------------------- |
| rtk.SOL_TIME                          | RTK输出解报文时间            |
| rtk.REQ_TIME                          | RTK请求VRS电文时间          |

---



## rtk_sec常量

RTK时间单位

| **常量**                              | **说明**                    |
| ------------------------------------  | --------------------------- |
| rtk.SEC_1S                            | 时间间隔1S                  |
| rtk.SEC_2S                            | 时间间隔2S                  |
| rtk.SEC_5S                            | 时间间隔5S                  |
| rtk.SEC_10S                           | 时间间隔10S                 |

---



## rtk_status常量

RTK状态

| **状态**                              | **说明**                    |
| ------------------------------------  | --------------------------- |
|10000                                  |未知状态|
|11000                                  |鉴权成功|
|11001                                  |鉴权过程遇到失败|
|11002                                  |鉴权参数缺失|
|11003                                  |鉴权存在无效的参数|
|11004                                  |鉴权启用了无效的服务请求|
|11005                                  |鉴权遇到未知错误|
|11006                                  |鉴权遇到网络不通，服务器访问异常|
|12000                                  |鉴权（appkey）应用不存在|
|12001                                  |鉴权（appkey）应用用量已到达限额|
|14001                                  |鉴权设备编码已被占用|
|16001                                  |无效的GGA，找不到VRS点|
|16002                                  |没有观测电文|
|16003                                  |没有导航电文|
|16004                                  |没有导航电文和观测电文|
|16005                                  |不存在的VRS信息|
|17000                                  |TOKEN过期|
|17001                                  |无效的TOKEN|
|17002                                  |TOKEN不存在|
|18000                                  |初始化成功|
|18001                                  |初始化失败|
|18002                                  |启动成功|
|18003                                  |启动失败|
|18004                                  |停止|
|18005                                  |资源清除|
|19001                                  |配置有误|
|19002                                  |NTRIP服务器鉴权失败|
|19003                                  |NTRIP服务器重连|
|20000                                  |未知错误|
|21001                                  |系统错误，比如内存申请失败等|
|21002                                  |网络异常|
|21003                                  |网络权限错误|
|21004                                  |配置出错|
|21005                                  |参数错误|
|21006                                  |账户错误|
|21007                                  |服务不可访问|
|21008                                  |服务器异常|
|22000                                  |初始化成功|
|22001                                  |初始化失败|
|22002                                  |启动成功|
|22003                                  |启动失败|
|22004                                  |关闭成功|
|22005                                  |关闭失败|
|22006                                  |清理成功|
|22007                                  |清理失败|
|23000                                  |运行时错误，如配置socket_dir权限问题等|
|23001                                  |无定位结果，GGA无定位标识或等于0|
|23002                                  |有定位结果，GGA的定位标识大于0|
|24000                                  |账号参数错误|
|24001                                  |设备未绑定账号|
|24002                                  |设备需要手动激活|
|24003                                  |账户配额已满|
|24004                                  |账号已过期|
|24005                                  |账号快过期|
|24006                                  |账号需要绑定|
|24007                                  |无VDR权限，VDR指车载惯导服务，与账号权限有关|
|24008                                  |无PDR权限，PDR指行人惯导服务，与账号权限有关|
|24009                                  |无AGNSS权限，AGNSS指加速定位服务，与账号权限有关|
|24010                                  |无RTK权限，RTK指差分服务，与账号权限有关|
|24011                                  |鉴权成功|
|24012                                  |鉴权需要手动激活|
|24013                                  |鉴权需要终端激活
|24014                                  |设备请求正在处理中存在以下几种可能：1.过快请求2.实例下存在剩余未绑定DSK，但是均已过期3.服务器逻辑异常，比如数据库不可访问|
|24015                                  |账号被禁用|
|24016                                  |功能列表部分无效|
|24017                                  |功能列表全部无效|
|24018                                  |鉴权失败|
|26000                                  |请求差分服务成功|
|26001                                  |请求差分服务失败|
|26002                                  |关闭差分服务成功|
|26003                                  |关闭差分服务失败|
|26004                                  |差分服务不可用|
|26005                                  |GGA不在服务范围内|
|26006                                  |无效GGA|
|28000                                  |NTRIP连接成功|
|28001                                  |NTRIP收到差分数据|
|28002                                  |NTRIP断开|
|28003                                  |NTRIP过程中|

---



## RTK消息

RTK消息上报

| **消息**                              | **说明**                    |
| ------------------------------------  | --------------------------- |
| MSG_RTK_INFO                          | RTK消息                     |

#### MSG_RTK_INFO
function(msg)
msg：显示参数，table类型，包含：
| **参数**    | **释义**                                                     | **取值**                                |
| ----------- | ------------------------------------------------------------ | --------------------------------------- |
| id          | 消息ID                                                       | 消息ID，用户可不理会                    |
| status      | RTK运行状态                                                  | SDK返回的状态，见rtk_status常量          |
| data        | RTK输出的高精度NMEA数据                                      | NMEA协议                                 |


```lua
    rtos.on(rtos.MSG_RTK_INFO, function(msg)
        log.info("rtk",msg.id,msg.status,msg.data)
    end)
```

---



## rtk.open(param)

打开RTK功能

**参数**

param：显示参数，table类型，包含：
| **参数**    | **释义**                                                     | **取值**                                |
| ----------- | ------------------------------------------------------------ | --------------------------------------- |
| appKey      | 应用程序唯一标识                                             | 由RTK服务提供商提供                      |
| appSecret   | 应用密钥                                                     | 由RTK服务提供商提供，可不填              |
| solMode     | RTK解算模式                                                  | 见rtk_sol_mode常量                        |
| solSec      | RTK输出解报文时间间隔                                        | 见rtk_sec常量                            |
| reqSec      | RTK请求VRS电文时间间隔                                       | 见rtk_sec常量                            |

**返回值**

|返回值|类型|释义|取值|
|-|-|-|-|
|result|number|返回RTK打开的结果|0打开成功<0打开失败|

**例子**

```lua
    local para =
    {
        appKey = "A48k297jhqeo", 
        appSecret = "956f15a90a318e34",
		solMode = rtk.SOLMODE_RTK,
		solSec = rtk.SEC_5S,
		reqSec = rtk.SEC_5S
    }
	rtk.open(para);

```

---



## rtk.set_mode(mode)

设置RTK解算模式

**参数**

|参数|类型|释义|取值|
|-|-|-|-|
|mode|number|RTK解算模式|见rtk_sol_mode常量|

**返回值**

无

**例子**

```lua
    rtk.set_mode(rtk.SOLMODE_RTK)

```

---



## rtk.set_time(timetype,time)

设置RTK内部时间

**参数**

|参数|类型|释义|取值|
|-|-|-|-|
|settype|number|支持的时间类型|见rtk_time_type常量|
|time|number|RTK时间单位|见rtk_sec常量|

**返回值**

无

**例子**

```lua
    rtk.set_time(rtk.SOL_TIME,rtk.SEC_5S)
    rtk.set_time(rtk.REQ_TIME,rtk.SEC_5S)

```

---



## rtk.write(data)

写入NMEA数据以及原始观测量

**参数**

|参数|类型|释义|取值|
|-|-|-|-|
|data|number|NMEA数据以及原始观测量||

**返回值**

无

**例子**

```lua
    local function nmeaCb(nmeaItem)
        rtk.writeNmea(nmeaItem)
    end
	gpsHxxt.setUart(2,115200,8,uart.PAR_NONE,uart.STOP_1)
	gpsHxxt.setNmeaMode(2,nmeaCb)
	gpsHxxt.open(gpsHxxt.DEFAULT,{tag="rtk"})

```

---



## rtk.close() 

关闭RTK功能

**参数**

无

**返回值**

无

**例子**

```lua
    rtk.close()

```

---




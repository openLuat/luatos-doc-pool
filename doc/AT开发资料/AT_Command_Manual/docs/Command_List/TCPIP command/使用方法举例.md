## 使用方法举例

由于这部分的命令具有高度相关性，所以将各个命令的应用例程集中在一起描述。

举例：

| 命令（→）/返回（←） | 实例                                                         | 解释和说明                                                   |
| ------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
|                     | **TCP非透传应用1：模块做为客户端，单链接，发送数据**<br>（事实上，TCP发送方式有快发和慢发两种，由+CIPQSEND命令来设置发送方式。区别就是：慢发每发送一笔数据需要服务器那边的确认，而快发则发送到模块就可以了，不需要服务器的确认。慢发可能会出现长时间没响应的情况，AT通道就堵住了，所以建议采用**快发**模式） |                                                              |
| →                   | AT+CREG?                                                     | 查询当前GPRS注册状态                                         |
| ←                   | +CREG: 0,1 <br>OK                                            | <n>=0，表示禁用URC上报<br><stat>=1，标识已经注册GPRS网络，而且是本地网 |
| →                   | AT+CGATT?                                                    | 查看当前GPRS附着状态                                         |
| ←                   | +CGATT: 1<br> OK                                             | <state>=1，标明当前GPRS已经附着                              |
| →                   | AT+CIPMUX=0                                                  | 设置为单链接模式                                             |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPQSEND=1                                                | 设置为快发模式（推荐使用这种模式）                           |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CSTT                                                      | 启动任务，设置APN <br>模块注册网络后会从网络自动获取<apn>并激活一个PDP上下文（此<apn>可以通过AT+CGDCONT?来查询），所以直接输入AT+CSTT即可，模块内部会按照自动获取的<apn>来设置CSTT的APN |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIICR                                                     | 激活移动场景，获取IP地址                                     |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIFSR                                                     | 查询分配的IP地址                                             |
| ←                   | 010.083.172.111                                              |                                                              |
| →                   | AT+CIPSTATUS                                                 | 查询下链接状态                                               |
| ←                   | OK STATE: IP STATUS                                          |                                                              |
| →                   | AT+CIPSTART="TCP","60.166.18.9",7500<br>或<br>AT+CIPSTART="TCP","60.166.18.9","7500" | 其中：<br>"TCP"为链接的协议类型<br>"60.166.18.9" 为对端服务器的IP地址<br>7500 为对端服务器的TCP端口号<br>注：CIPSTART设置命令所有的参数，双括号可以用，也可以不用 |
| ←                   | OK                                                           |                                                              |
| ←(URC)              | CONNECT OK                                                   | 如果链接成功，会有如此URC上报                                |
| →                   | AT+CIPSTATUS                                                 | 查询下链接状态                                               |
| ←                   | OK <br>STATE: CONNECT OK                                     | 链接建立成功                                                 |
| →                   | AT+CIPSEND                                                   | 发送数据（不定长度，手动发送）                               |
| →                   | >1234567890<CTRL-Z>                                          | 当出现">"后，输入待发送的数据：0123456789。<CTRL-Z>用来发送数据，发送16进制数0x1A即等同于发送<CTRL-Z>。 |
| ←                   | DATA ACCEPT:10                                               | 发送成功而且对端服务器收到数据                               |
| →                   | AT+CIPACK                                                    | 每发一笔，查询下发送状态，可以知道上笔数据服务器有没有收到   |
| ←                   | +CIPACK: 10,10,0 <br>OK                                      | 第一个10，表明已经发送的数据字节数，第二个10表示服务器收到的数据字节数，0表示服务器尚未收到的数据字节数 |
| →                   | AT+CIPSEND=10                                                | 发送数据（确定长度）                                         |
| →                   | >1234567890                                                  |                                                              |
| ←                   | DATA ACCEPT:10                                               | 输入数据达到10个字节，不用发送<CTRL-Z>即十六进制的1A，会自动发送 |
| →                   | AT+CIPATS=1,10                                               | 设置自动发送，自动发送的定时为10S                            |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPSEND                                                   | 发送数据                                                     |
| →                   | >1234567890                                                  |                                                              |
| ←                   | DATA ACCEPT:10                                               | 10s定时器溢出，不用发送<CTRL-Z>即十六进制的1A，数据会自己发送 |
| →                   | AT+CIPSEND=100                                               |                                                              |
| →                   | >123                                                         |                                                              |
| ←                   | DATA ACCEPT:3                                                | 10s定时器溢出，输入内容不必达到100字节，也不用发送<CTRL-Z>即十六进制的1A，数据会自己发送 |
| →                   | AT+CIPCLOSE                                                  | 关闭TCP链接                                                  |
| ←                   | CLOSE OK                                                     | 关闭成功                                                     |
| →                   | AT+CIPSTATUS                                                 | 查询下链接状态                                               |
| ←                   | OK STATE: TCP CLOSED                                         | TCP链接已经关闭                                              |
| →                   | AT+CIPSHUT                                                   | 关闭移动场景                                                 |
| ←                   | SHUT OK                                                      | 关闭成功                                                     |
| →                   | AT+CIFSR                                                     | 查询当前的模块IP                                             |
| ←                   | ERROR                                                        | IP地址已经没有了                                             |
|                     | **TCP非透传应用2：模块做为客户端，单链接，发送数据，开启SSL功能** |                                                              |
| →                   | AT+CIPMUX=0                                                  | 设置为单链接模式                                             |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPQSEND=1                                                | 发送模式为快发                                               |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPSTATUS                                                 | 查询链接状态                                                 |
| ←                   | OK STATE: IP INITIAL                                         |                                                              |
| →                   | AT+CIPSSL=1                                                  | 打开SSL功能(本例中双方都**不**需要验证证书)                  |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPSTART="TCP","60.166.18.9",7500                         | 当模块设置为单链接并且状态为IP INITIAL时，也可以用CIPSTART直接建立连接，不必先输入CSTT CIICR CIFSR<br>请写实际的服务器地址和端口，不要照抄 |
| ←                   | OK                                                           |                                                              |
| ←(URC)              | CONNECT OK                                                   | 如果链接成功，会有如此URC上报                                |
| →                   | AT+CIPSEND                                                   | 发送数据                                                     |
| →                   | >1234567890<CTRL-Z>                                          | <CTRL-Z>用来发送数据，发送16进制数0x1A即等同于发送<CTRL-Z>。 |
| ←                   | DATA ACCEPT:10                                               | 表明模块接收了从TE输入的10个字节的待发数据                   |
|                     | ……                                                           | +CIPCLOSE,+CIPSHUT，不再赘述                                 |
|                     | **TCP非透传应用3：模块做为客户端，单链接，发送数据，开启SSL功能（双向证书验证）** |                                                              |
| →                   | AT+CIPMUX=0                                                  | 设置为单链接模式                                             |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPQSEND=1                                                | 设置为快发                                                   |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPSSL=1                                                  | 开启SSL功能开关为开                                          |
| ←                   | OK                                                           |                                                              |
| →                   | AT+FSCREATE="ca.crt"                                         | 创建CA 证书文件                                              |
| ←                   | OK                                                           |                                                              |
| →                   | AT+FSCREATE="client.crt"                                     | 创建客户端证书文件                                           |
| ←                   | OK                                                           |                                                              |
| →                   | AT+FSCREATE="client.key"                                     | 创建客户端密钥文件                                           |
| ←                   | OK                                                           |                                                              |
| →                   | AT+FSWRITE="ca.crt",0,2080,15                                | 文件长度2080只是举例，要根据实际填写。下同。                 |
| ←                   | >                                                            | 这里输入CA证书文件                                           |
| ←                   | OK                                                           |                                                              |
| ←                   | AT+FSWRITE="client.crt",0,128,10                             |                                                              |
| →                   | >                                                            | 这里输入客户端证书文件                                       |
| ←                   | OK                                                           |                                                              |
| →                   | AT+FSWRITE="client.key",0,188,10                             |                                                              |
| ←                   | >                                                            | 这里输入客户端密钥文件                                       |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="cacert",0,"ca.crt"                                | 设置服务器CA 证书SSL 上下文id，在单链接的情况下缺省为0       |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="clientcert",0,"client.crt"                        | 设置客户端证书                                               |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="clientkey",0,"client.key"                         | 设置客户端KEY                                                |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="seclevel",0,2                                     | 设置安全等级                                                 |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="ciphersuite",0,0X0035                             | 设置加密套件                                                 |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="clientrandom",0,101B12C3141516171F19202122232425262728293031323334353637 | 设置随机数                                                   |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPSTART=TCP,tcplab.openluat.com,57513                    |                                                              |
| ←                   | OK                                                           |                                                              |
| ←(URC)              | CONNECT OK                                                   |                                                              |
| →                   | AT+CIPSEND=10                                                | 发送数据（确定长度）                                         |
| →                   | >1234567890                                                  |                                                              |
| ←                   | DATA ACCEPT:10                                               | 输入数据达到10个字节，不用发送<CTRL-Z>即十六进制的1A，数据会自动发送 |
| →                   | AT+CIPSHUT                                                   |                                                              |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPSSL=0                                                  | 关闭SSL功能                                                  |
| ←                   | OK                                                           |                                                              |
|                     | **UDP非透传应用1：模块做为客户端，单链接，数据发送**         |                                                              |
| →                   | AT+CIPMUX=0                                                  | 设置为单链接模式                                             |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPQSEND=1                                                | 设置为快发模式                                               |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CSTT                                                      | 启动任务，设置APN<br>模块注册网络后会从网络自动获取<apn>并激活一个PDP上下文（此<apn>可以通过AT+CGDCONT?来查询），所以直接输入AT+CSTT即可，模块内部会按照自动获取的<apn>来设置CSTT的APN |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIICR                                                     | 激活移动场景，获取IP地址                                     |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIFSR                                                     | 查询分配的IP地址                                             |
| ←                   | 010.083.172.111                                              |                                                              |
| →                   | AT+CIPSTART="UDP","60.166.18.9",6100                         | 建立UDP链接，其中："UDP"为链接的协议类型"60.166.18.9" 为对端服务器的IP地址6100 为对端服务器的UDP端口号 |
| ←                   | OK                                                           |                                                              |
| ←(URC)              | CONNECT OK                                                   | 如果链接成功，会有如此URC上报                                |
| →                   | AT+CIPSEND                                                   | 发送数据                                                     |
| →                   | >1234567890<CTRL-Z>                                          | <CTRL-Z>即十六进制的1A                                       |
| ←                   | DATA ACCEPT:10                                               | 成功将数据发送到模块                                         |
|                     | ……                                                           | +CIPCLOSE,+CIPSHUT，不再赘述                                 |
|                     | **多连接应用1：模块做为客户端，多链接，发送数据，SSL证书双向认证功能打开（快发）****注：本例是同时链接不同的两个服务器。** |                                                              |
| →                   | AT+CIPSSL=1                                                  | 开启SSL功能开关                                              |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPMUX=1                                                  |                                                              |
| ←                   | OK                                                           |                                                              |
| →                   | AT+FSCREATE="server1.crt"                                    | 创建server1 的CA 证书文件                                    |
| ←                   | OK                                                           |                                                              |
| →                   | AT+FSCREATE="server2.crt"                                    | 创建server2 的CA 证书文件                                    |
| ←                   | OK                                                           |                                                              |
| →                   | AT+FSCREATE="client.crt"                                     | 创建客户端证书文件                                           |
| ←                   | OK                                                           |                                                              |
| →                   | AT+FSCREATE="client.key"                                     | 创建客户端密钥文件                                           |
| ←                   | OK                                                           |                                                              |
| →                   | AT+FSWRITE="server1.crt",0,2080,15                           | 文件长度2080只是举例，要根据实际填写。下同。                 |
| ←                   | >                                                            | 这里输入服务器1的CA证书文件                                  |
| ←                   | OK                                                           |                                                              |
| →                   | AT+FSWRITE="server1.crt",0,1962,15                           |                                                              |
| ←                   | >                                                            | 这里输入服务器2的CA证书文件                                  |
| ←                   | OK                                                           |                                                              |
| ←                   | AT+FSWRITE="client.crt",0,128,10                             |                                                              |
| →                   | >                                                            | 这里输入客户端证书文件                                       |
| ←                   | OK                                                           |                                                              |
| →                   | AT+FSWRITE="client.key",0,188,10                             |                                                              |
| ←                   | >                                                            | 这里输入客户端密钥文件                                       |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="cacert",1,"server1.crt"                           | 设置服务器1的CA 证书 多链接的SSL上下文id和多链接的链接id绑定，链接1的SSL上下文id也是1 |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="cacert",2,"server2.crt"                           | 设置服务器2的CA 证书                                         |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="clientcert",1,"client.crt"                        | 设置SSL上下文1（即链接1）的客户端证书                        |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="clientcert",2,"client.crt"                        | 设置SSL上下文2（即链接2）的客户端证书                        |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="clientkey", 1,"client.key"                        | 设置SSL上下文1（即链接1）的客户端KEY                         |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="clientkey", 2,"client.key"                        | 设置SSL上下文2（即链接2）的客户端KEY                         |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="seclevel",1,2                                     | 设置SSL上下文1（即链接1）的安全等级：双向认证                |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="seclevel",2,2                                     | 设置SSL上下文2（即链接2）的安全等级：双向认证                |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="ciphersuite",1,0X0035                             | 设置SSL上下文1（即链接1）的加密套件                          |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="ciphersuite",2,0X0035                             | 设置SSL上下文2（即链接2）的加密套件                          |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="clientrandom",1,10B12C3141516171F19202122232425262728293031323334353637D | 设置链接1的随机数                                            |
| ←                   | OK                                                           |                                                              |
| →                   | AT+SSLCFG="clientrandom",2,581B12C3141516171F1920214A23249C262728293031323334353632 | 设置链接2的随机数                                            |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPQSEND=1                                                | 设置为快发模式                                               |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CSTT                                                      | 设置模块APN 模块<br>注册网络后会从网络自动获取<apn>并激活一个PDP上下文（此<apn>可以通过AT+CGDCONT?来查询），所以直接输入AT+CSTT即可，模块内部会按照自动获取的<apn>来设置CSTT的APN |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIICR                                                     |                                                              |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIFSR                                                     |                                                              |
| ←                   | 010.083.172.111                                              |                                                              |
| →                   | AT+CIPSTART=1,"TCP","60.166.12.210",7500                     |                                                              |
| ←                   | OK                                                           |                                                              |
| ←(URC)              | 1,CONNECT OK                                                 | Id=1的 TCP 链接成功建立                                      |
| →                   | AT+CIPSTART=2,"TCP","60.166.13.215",6100                     |                                                              |
| ←                   | OK                                                           |                                                              |
| ←(URC)              | 2,CONNECT OK                                                 | Id=2的 TCP 链接成功建立                                      |
| →                   | AT+CIPSTATUS                                                 | 查询当前链路状态                                             |
| ←                   | OK<br> STATE: IP PROCESSING <br>C: 0,,"","","","INITIAL"<br>C: 1,0,"TCP","60.166.12.210","7500","CONNECTED"<br>C: 2,0,"TCP","60.166.12.210","7500","CONNECTED"<br>C: 3,,"","","","INITIAL"<br>C: 4,,"","","","INITIAL"<br>C: 5,,"","","","INITIAL" |                                                              |
| →                   | AT+CIPSEND=1                                                 | 在 TCP 1链接上发送数据                                       |
| →                   | >1234567890<CTRL-Z>                                          | <CTRL-Z>即十六进制的1A                                       |
| ←                   | DATA ACCEPT:1,10                                             |                                                              |
| →                   | AT+CIPSEND=2                                                 | 在 TCP 2链接上发送数据                                       |
| →                   | >1234567890<CTRL-Z>                                          | <CTRL-Z>即十六进制的1A                                       |
| ←                   | DATA ACCEPT:2,10                                             |                                                              |
|                     | ……                                                           | 其他发送数据的动作                                           |
| →                   | AT+CIPSHUT                                                   | 如果想关闭所有的连接                                         |
| ←                   | SHUT OK                                                      |                                                              |
| →                   | AT+CIPMUX=0                                                  | 如果想关闭多连接模式，则必须在AT+CIPSHUT后才可以             |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPSSL=0                                                  | 关闭SSL功能。                                                |
| ←                   | OK                                                           |                                                              |
|                     | **多连接应用2：模块做为客户端，多链接，发送数据，未开启SSL功能** |                                                              |
| →                   | AT+CIPMUX=1                                                  | 设置为多链接模式                                             |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPQSEND=1                                                | 设置为快发模式                                               |
| ←                   | OK                                                           |                                                              |
|                     | ……                                                           | **仿照**[TCP非透传应用1](#TCP非透传应用1)**的例子，**依次发送 CSTT CIICR  CIFSR这三个命令 |
| →                   | AT+CIPSTART=4,"TCP","60.166.12.210",7500                     |                                                              |
| ←                   | OK                                                           |                                                              |
| ←(URC)              | 4, CONNECT OK                                                | Id=6的 TCP 链接成功建立                                      |
| →                   | AT+CIPSTART=5,"UDP","60.166.12.210",6100                     |                                                              |
| ←                   | OK                                                           |                                                              |
| ←(URC)              | 5, CONNECT OK                                                | Id=7的 UDP 链接成功建立                                      |
| →                   | AT+CIPSEND=4,10                                              | 在 TCP 链接上发送数据，定长发送                              |
| →                   | >1234567890                                                  |                                                              |
| ←                   | DATA ACCEPT:4,10                                             |                                                              |
| →                   | AT+CIPSEND=5                                                 | 在 UDP 链接上发送数据，不定长发送                            |
| →                   | >1234567890<CTRL-Z>                                          | <CTRL-Z>即十六进制的1A                                       |
| ←                   | DATA ACCEPT:5,10                                             |                                                              |
| →                   | AT+CIPATS=1,10                                               | 设置为自动发送，并且定时器设置为10S，从该命令返回OK时开始计时 |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPSEND=4                                                 | 在id=6的TCP链接上发送数据                                    |
| →                   | >TEST Auto fast send                                         | 输入待发送的字符串（不必输入<CTRL-Z>即十六进制的1A）         |
| ←                   | DATA ACCEPT:4,19                                             | 10S定时器到时，数据自动发送                                  |
|                     | ……                                                           | +CIPCLOSE,+CIPSHUT，不再赘述                                 |
|                     | **单链接非透传时接收数据：**                                 |                                                              |
|                     | ……                                                           | 建立一个TCP链接，前面已经详述，在此不再赘述                  |
| →                   | AT+CIPHEAD=1                                                 | 设置接收数据时，有数据头                                     |
| ←                   | OK                                                           |                                                              |
| ←(URC)              | +IPD,4:TEST                                                  | 模块收到SERVER那边发来的一串字符数据：TEST                   |
| →                   | AT+CIPSHOWTP=1                                               | 设置接收数据时，显示数据所使用的协议                         |
| ←                   | OK                                                           |                                                              |
| ←(URC)              | +IPD,4,TCP:TEST                                              | 模块收到SERVER那边发来的数据：TEST。所使用的协议也会显示出来。**如果是UDP链接，则会显示：+IPD,4,UDP:TEST** |
| →                   | AT+CIPSRIP=1                                                 | 设置接收数据时显示发送方的IP地址和端口                       |
| ←                   | OK                                                           |                                                              |
| ←(URC)              | RECV FROM: 60.166.12.210:7500<br>+IPD,4:TEST                 | 接收服务器发来的数据，是一个字符"TEST"，长度为4              |
| →                   | AT+CIPSHOWTP=0                                               | 不在接收数据头中显示协议类型                                 |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPHEAD=0                                                 | 不显示数据头                                                 |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPSRIP=0                                                 | 不显示数据发送放的IP地址和端口                               |
| ←                   | OK                                                           |                                                              |
| ←(URC)              | TEST                                                         | 此时接收到数据:TEST                                          |
|                     | **多链接非透传时接收数据：**                                 |                                                              |
|                     | ……                                                           | **仿照**[TCP非透传应用1](#TCP非透传应用1)**的例子，**依次发送 CSTT CIICR  CIFSR这三个命令，并建立连接号为0的TCP链接和连接号为1的UDP链接 |
| ←(URC)              | +RECEIVE,0,7: <br>TEST123                                    | 在链接0的TCP链接上收到7个字符的字符串：TEST123               |
| ←(URC)              | +RECEIVE,1,10: <br>TEST123456                                | 在链接1的UDP链接上收到10个字符的字符串：TEST123456           |
|                     | **透明传输应用1：TCP数据传输**                               |                                                              |
| →                   | AT+CIPMODE=1                                                 | 设置TCPIP应用为透明传输模式                                  |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIPSTART="TCP","60.166.18.9",7500                         | 建立TCP链接，其中："TCP"为链接的协议类型"60.166.18.9" 为对端服务器的IP地址7500 为对端服务器的TCP端口号 |
| ←                   | OK                                                           |                                                              |
| ←(URC)              | CONNECT                                                      | 如果链接成功，会有如此URC上报                                |
| →/←                 | ………                                                          | 透传开始，在这里输入数据并传送，此时也可以接收服务器传来的数据 |
| →                   | ………+++                                                       | 如果想返回AT命令模式，则在数据后面输入 <br>**注：** +++需要满足一定的条件才会被模块认为是escape sequence，否则会被认为是数据:<br>1，第一个+之前需要1000ms的间隔<br>2，最后一个+之后需要500ms的间隔<br>3，三个+之间的间隔不能超过500ms |
| ←                   | OK                                                           | OK表示已经返回到AT命令模式                                   |
| →                   | ATO                                                          | ATO用于返回数据模式                                          |
| ←                   | CONNECT                                                      | CONNECT表示进入透传模式                                      |
| →/←                 | ……….                                                         | 此时又可以开始传输数据                                       |
| ←                   | TCP ERROR:××  或<br>CLOSED                                   | 当传输中有协议栈错误发生时，会转入AT命令状态，并上报该错误码 |
| →                   | AT+CIPSHUT                                                   | 发生这种情况时，+CIPSHUT关闭连接。如果没有错误发生，则+++返回AT命令状态，再+CIPSHUT关闭连接 |
| ←                   | SHUT OK                                                      |                                                              |
|                     | **透明传输应用2：UDP数据传输**                               |                                                              |
| →                   | AT+CIPMODE=1                                                 | 设置TCPIP应用为透明传输模式                                  |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CSTT                                                      | 设置模块APN模块注册网络后会从网络自动获取<apn>并激活一个PDP上下文（此<apn>可以通过AT+CGDCONT?来查询），所以直接输入AT+CSTT即可，模块内部会按照自动获取的<apn>来设置CSTT的APN |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIICR                                                     | 激活移动场景，获取IP地址                                     |
| ←                   | OK                                                           |                                                              |
| →                   | AT+CIFSR                                                     | 查询分配的IP地址                                             |
| ←                   | 010.083.172.111                                              |                                                              |
| →                   | AT+CIPSTART="UDP","60.166.18.9",6100                         | 建立UDP链接，其中："UDP"为链接的协议类型"60.166.18.9" 为对端服务器的IP地址6100 为对端服务器的UDP端口号 |
| ←                   | OK                                                           |                                                              |
| ←(URC)              | CONNECT                                                      | 如果链接成功，会有如此URC上报                                |
| →/←                 | ………                                                          | 透传开始，在这里输入数据并传送，此时也可以接收服务器传来的数据 |
| ←                   | UDP ERROR:××                                                 | 当传输中有协议栈错误发生时，会转入AT命令状态，并上报该错误码 |
| →                   | AT+CIPSHUT                                                   | 发生这种情况时，+CIPSHUT关闭连接。如果没有错误发生，则+++返回AT命令状态，再+CIPSHUT关闭连接 |
| ←                   | SHUT OK                                                      |                                                              |
| ←                   | OK                                                           |                                                              |
|                     | **域名解析：****注：该命令****只有在执行完at+cstt、at+ciicr、at+cifsr后才能正常工作****，这三条命令的输入方法请参考：**[TCP非透传应用1](#TCP非透传应用1)**的例子** |                                                              |
| →                   | AT+CDNSGIP="WWW.SINA.COM.CN"                                 | 解析新浪网站的域名                                           |
| ←                   | OK <br>+CDNSGIP:1,"WWW.SINA.COM.CN","221.179.180.76"         | 返回IP地址                                                   |
|                     | **发送和接收格式总结:**                                      |                                                              |
|                     | 数据发送(多链接模式，以链接号<n>=5 为范例) <br><br>![](../../../../../image/AT开发资料/AT Command Manual/718P/TCPIP command/2.png)<br> 数据接收(多链接模式以链接号<n>=1 为范例) <br>![](../../../../../image/AT开发资料/AT Command Manual/718P/TCPIP command/3.png) |                                                              |

 

**如果模块出现上下文去激活的主动上报，该如何处理：**

 

| ←(URC) | +PDP DEACT                 | PDP去激活，此时需要重新激活一个PDP上下文才能继续使用TCPIP的AT命令 |
| ------ | -------------------------- | ------------------------------------------------------------ |
| →      | AT+CIPSHUT                 | 关闭移动场景                                                 |
| ←      | OK                         |                                                              |
|        | 此时有两种处理方式，见右侧 | 1） AT+CFUN=0，AT+CFUN=1后，再重新建立连接<br>2） AT+RESET重启模块后再重新建立连接 |

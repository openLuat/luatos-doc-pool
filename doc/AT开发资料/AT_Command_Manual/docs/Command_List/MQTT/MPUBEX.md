## 发布定长消息：AT+MPUBEX

本命令从客户端到服务器，以定长方式传送应用消息。

**注：只支持最大4100字节收发。**

 

语法规则：

| 命令类型 | 语法                                     | 返回                                                         | 说明                                     |
| -------- | ---------------------------------------- | ------------------------------------------------------------ | ---------------------------------------- |
| 设置命令 | `AT+MPUBEX=<topic>,<qos>,<retain>,[len]` | 首先返回一个><br>1）如果指定了len，当长度大于等于len就退出数据模式发送数据返回OK。<br>2）如果没指定len，则以1A做为结束符，或者5s超时（两次数据间隔超过5s）发送数据返回OK | qos=0                                    |
|          |                                          | 首先返回一个><br>1）如果指定了len，当长度大于等于len就退出数据模式发送数据返回OK。<br>2）如果没指定len，则以1A做为结束符，或者5s超时（两次数据间隔超过5s）发送数据返回OK <br>PUBACK | qos=1                                    |
|          |                                          | 首先返回一个><br>1）如果指定了len，当长度大于等于len就退出数据模式发送数据返回OK。<br>2）如果没指定len，则以1A做为结束符，或者5s超时（两次数据间隔超过5s）发送数据返回OK <br>PUBREC <br>PUBCOMP | qos=2                                    |
|          |                                          | ERROR                                                        | 失败。<br>一般由语法错误或条件不具备引起 |
| 测试命令 | AT+MPUBEX=?                              | `+MPUBEX:<topic>,(0-2),(0-1),<len>` <br>OK                   |                                          |

 

参数定义：

| 参数       | 定义     | 取值   | 对取值的说明                                                 |
| ---------- | -------- | ------ | ------------------------------------------------------------ |
| `<qos>`    | 服务质量 | 0      | 至多一次                                                     |
|            |          | 1      | 至少一次                                                     |
|            |          | 2      | 确保只有一次                                                 |
| `<retain>` | 保留标志 | 0      | 服务器不会存储这个消息也不能移除或替换任何现存的保留消息。   |
|            |          | 1      | 服务器必须存储这个应用消息和它的服务等级质量(QOS)，以便它可以被分发给未来的主题名匹配的订阅者。 |
| `<topic>`  | 消息主题 | 字符串 | 最大256个字节。可以用""括住，也可以不用""                    |
| `<len>`    | 数据长度 | 1~4100 |                                                              |

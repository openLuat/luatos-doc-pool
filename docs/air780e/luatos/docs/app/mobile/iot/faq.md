# 常见问题

### sim卡不识别问题？

sim卡不识别按以下步骤进行：
1：看模块开机没？mobile.simPin() 当前sim卡是否准备好，一般返回false就是没卡，如果返回false，按以下几点排查：
2：sim卡是不是Ok？sim卡方向有没反。
3：每个脚对地用万用表，打到二级管档位量下，红接地，黑接每个管脚，值是400-500之间正常。
4：看模块与卡座之间连线有没有问题，引脚对地阻值是不是正常，引脚间有没短路，
原理图和Pcb网络名与sim卡座实物对不对，卡座是否接触良好，如果sim卡一插入，vdd和clk就对地短路，一般是卡座问题。
5：示波器测试下sim_vdd波形，有个1.8-3.3v的高电平跳变，如果波形正常，一般是卡座和模块引脚之间问题，要识别到卡，才会有电压输出。
6：如果是贴片卡，可以先拆下贴片卡，飞线到一个可以识别到卡的卡座到模块管脚，看下是否贴片卡问题

### 怎么判断sim卡是移动，联通还是电信？

可以通过查询卡的IMSI来判断
IMSI共有15位，其结构如下：
MCC+MNC+MSIN ，(MNC+MSIN=NMSI)
MCC：Mobile Country Code，移动国家码，MCC的资源由国际电联(ITU)统一分配和管理，唯一识别移动用户所属的国家，共3位，中国为460;
MNC:Mobile Network Code，移动网络码，共2位，中国移动00、02、04、07，08，中国联通01，中国电信03，11
MSIN:Mobile Subscriber Identification Number共有10位
LuatOS获取IMSI方法

```lua
mobile.imsi() --460081899904186 --MNC为08说明是中国移动卡
```

## 模块如何设置APN

1、如果是公网SIM卡，不需要用户主动设置APN，软件自动去网络端查询APN进行设置。<br>
2、如果是专网SIM卡，首先咨询SIM卡提供商APN参数，设置APN必须在入网前就设置好，比如在SIM卡识别完成前就设置好mobile.apn(index, cid, new_apn_name, user_name, password, ip_type, protocol)。

## 为什么4G模块专网卡连接服务器失败

1、有的专网卡没设置APN的情况下也能激活PDP，但是不能连专网卡指定的服务器，或者开机后模块没自动激活PDP，这个时候参考1，检查APN参数是否设置正确。<br>
2、如果有其他厂家的模块，对比测试下是否连接正常。<br>
3、如果无法百分百保证服务器配置没问题，最好在服务器端用wireshark抓包，或者在服务器上安装一个第三方工具，开启一个服务器端口来对比测试。<br>
4、用定向Ip的物联网卡，需要把域名或IP加入白名单才能使用。

### 专网卡访问白名单

用定向Ip的物联网卡，需要把域名或IP加入白名单才能使用，下面列出模块会访问的域名或IP服务器。

| 功能         | 地址                  | 端口  | 协议 |
| ------------ | --------------------- | ----- | ---- |
| 远程升级     | iot.openluat.com      | 80    | http |
| 日志服务     | dev_msg1.openluat.com | 12425 | udp  |
| 基站WIFI定位 | bs.openluat.com       | 12411 | udp  |
| AGPS星历下载 | download.openluat.com | 80    | http |
| NTP时间同步  | ntp.aliyun.com        | 123   | udp  |

## 无法注册网络、注册网络慢、无法附着网络、附着网络慢

1、参考SIM问题章节检查下是否不识卡。

2、检查下sim卡是否欠费，流量是否用完。【其他情况可以咨询卡商】

3、确认天线是否匹配。

4、检查天线是否连接、天线连接座子的接口是否正确、天线是否损坏【换天线确认】。

5、换卡、换板子对比测试，确保使用正常的硬件和sim卡测试。

6、确保模块支持当地的网络制式

7、偏远地区的网络覆盖可能不全，或者产品的天线射频指标不合格，想办法用手机对比测试；用手机对比测试时，注意手机要设置为和模块同样的网络制式，同时借助Cellular-Z工具确认。

8、环境因素（车库、地下室、电梯等）。

9、确认下是否所有设备在同一地点表现是否一致，有可能是伪基站造成的。

10、卡是不是专网卡，是否机卡绑定，专网卡需要设置正确的APN，机卡分离停机需要联系卡商，重新绑定。

11、如果模块是海外模块，请通过模块对应的规格书，查看是否有支持国内的频段，支持的频段对应的国内运营商是哪一家，测试环境周围是否有当前频段的基站。

## PDP需要手动激活吗？

4G网络会自动激活PDP，只有2G网络的时候需要手动激活PDP。

## 怎么确认PDP是否激活，及如何获取IP地址？

可以使用 socket.localIP() 接口可以获取到ip地址。

## 怎样获取模块公网IP？

获取不到，模块能获取的是运营商分配的内网IP，这也就决定了模块无法做服务器的原因。
如果一定要知道模块的数据是通过哪个外网IP发出去的，可以用模块连上服务器，跟模块建了链接后从服务器端查看此链接的client的IP。
如：可以借助 https://netlab.luatos.com/ 建一个TCP server，用模块通过tcp跟TCP server建了链接后就能查看外网IP。

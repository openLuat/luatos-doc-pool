# 合宙模组的功耗说明


## 一，合宙模组的低功耗特性概述

    - 1. 低功耗是合宙 4G Cat.1 模组最重要的特性之一；

    - 2. 合宙 4G Cat.1 模组有三种功耗模式，分别有各自的特点；

    - 3. 合宙 4G Cat.1 模组优异的低功耗表现，既有硬件设计的加持，也有软件协议算法的帮助；

    - 4. 不同的应用场景，按需选择不同的合宙 4G Cat.1 模组功耗模式，以及三种功耗模式之间的相互转换；

    - 5. 除实验室数据外，合宙更关注实网环境下的功耗表现，呈现给用户的效果更多以实网在线表现为准；


## 二、三种不同的功耗模式

### 1， 三种功耗模式的简捷定义

  合宙的模组有三种功耗模式， 分别是： 常规模式，低功耗模式，PSM+模式，定义如下：

    - 1）常规模式；

网络在线状态，随时响应服务器命令，CPU满频运行，外设功能全部可用，比如，所有GPIO电平都可以控制；

    - 2）低功耗模式；
网络在线状态，随时响应服务器命令，CPU降频运行，外设功能部份可用，比如，仅有AGPIO可以保持电平；

    - 3）PSM+模式；
网络离线状态，无法响应服务器命令，CPU降频运行，外设功能部份可用，比如，仅有AGPIO可以保持电平；


### 2，三种功耗模式的细节差异

  三种功耗模式的不同特性说明参见下表：

|                    | 常规模式               | 低功耗模式          | PSM+ 模式      |
| :---               | :---                  | :---               |                |
|4G在线状态           |  在线，长连接          |  在线，长连接       |离线，飞行模式   |
|CPU主频             |  满频                  | 降频               |  降频          |
|定时器唤醒           | 支持                  | 支持                |  支持          |
|中断唤醒             | 支持                  | 支持                |  支持          |
|服务器4G唤醒         | 支持，1秒内            |  支持，1秒内        | 不支持          |
|串口唤醒             | 支持                  |支持，唤醒时串口波特率要用9600|支持，唤醒时串口波特率要用9600|
| 上行发送            | 1秒内响应             |1秒内响应            | 1.5秒内响应     |
| VEXT电源输出状态    |  保持输出             | 不能保持输出，也不能保持关闭，间歇性输出状态|不能保持输出，也不能保持关闭，间歇性输出状态|
|所有GPIO管脚是否可以控制输出电平| 可以  | 可以   |不可以       |
|常规GPIO管脚是否可以保持电平    | 可以  | 可以   |不可以       |
|特殊AGPIO管脚是否可以保持电平   | 可以  | 可以   |可以       |
|RAM供电及唤醒后软件运行状态|RAM供电，正常工作，满血状态|RAM供电，唤醒后保持原状态运行|RAM掉电，唤醒后程序从初始状态运行(PSM+状态前运行数据丢失)|
|典型功耗表现|较低,4.5mA,17毫瓦|均衡,0.3mA,1.1毫瓦|极低,3uA,11微瓦|


上述表格的测试环境：

    - 1)Air780EPS，供电电压3.8V，移动网络，频段B3，RSRP值-88附近，DRX 2.56秒，

       心跳间隔5分钟，心跳数据100Byte，TCP协议，合宙web服务器，回环测试；

    - 2)Air780EPS，同等环境下，低功耗模式，DRX 1.28秒时，平均电流0.5mA，DRX 0.64秒时，
    
       平均电流0.7mA；

    - 3)Air780EPS，同等环境下，常规模式，DRX 1.28秒时，平均电流4.7mA，DRX 0.64秒，
    
       平均电流4.9mA；

    - 4)DRX，Discontinuous Reception，非连续接收，可简单理解为模块与基站之间保持心跳的间隔，
    
        一般为0.64秒/1.28秒/2.56秒，需要注意的是，DRX由基站根据网络实际情况而定，模组无法自行控制；
    
    - 5)除Air724UG 和 Air795 外，合宙其它所有型号的4G Cat.1模组全部支持低功耗模式和PSM+模式;
    
    - 6)Air780EPS 和 Air201 的功耗表现，在合宙所有模组里面最佳。

### 3，关于低功耗模式对 GPIO 影响的说明

    合宙Air700系列/Air780系列模组在"低功耗模式/PSM+模式"下不同GPIO的功能表现不一致，
    
    请务必根据产品定义所需严谨选择，避免改版；

    根据不同GPIO在"低功耗模式/PSM+模式下"的不同表现，可以将GPIO分为四类：

    - （1）AGPIO，有些文档中有时也会被写为AON_GPIO，AlwaysON，一直保持的意思；
        低功耗模式下既可以保持输出高，也可以保持输出低，但不能高低变换；

    - （2）AGPIOWU，也可以写为AON_GPIO_WAKEUP，既能在低功耗模式下输出保持(输出高低都可以，但不能高低变换)，
    
       也可以在低功耗模式下作为中断；

    - （3）WAKEUP，仅能作为输入，低功耗模式下可以作为中断；

    - （4）普通GPIO，低功耗模式下既不能保持输出高，也不能保持输出低。


## 三、合宙不同模组功耗对比

### （一）小数据量实时在线的功耗

   小数据量通信，低频次传输，但是又需要实时在线，方便手机或者其他上位机方便的控制物联网设备。

   本章描述的是，基于实网环境下，每次通信100个字节， 为了保持TCP连接不断链，几分钟和服务器通信一次。


#### 1、测试条件

    - 1， 供电电压：      3.8V；
    - 2， IO电平设置：   1.8V；
    - 3， 固件版本： 截止到2024年9月30日的最新LuatOS固件；
    - 4， 测试服务器：    airtest.openluat.com, "2901"，回环测试；
    - 5， 每次心跳的通信内容：  10字节字符串： "0123456789"，    循环10次，一共 100字节；
    - 6，  驻网频段与驻网小区ID：   B3频段，小区id：  153708387；
        其他频段的功耗，会略有差异，但是对于小数据量的传输场景来说，差异不会特别的大。
    - 7，  UART1串口波特率：         9600；
    - 8，  信号强度：         实网环境， RSRP[-86，-88]之间；
    - 9， 测试硬件：    合宙Air780E/Air780EQ/Air780EP/Air780EPS/Air700ECQ，通用全IO开发板，2.1版本。
          删除了可能产生耗电的外设，比如 LED状态灯。
 

#### 2、影响实网功耗的主要网络因素

在实网，实时在线，小数据量传输场景下，影响功耗的因素有很多，按照影响力从大到小排序， 分别是：

##### （1）心跳间隔时间

    在蜂窝通信的场景下，为了保持终端和服务器之间的TCP链接不断，
    
    要定时和服务器之间有心跳包的通信。
    
    这个心跳包的定时间隔，根据多年经验，不能低于5分钟。

    在不大于5分钟的条件下， 心跳包间隔越长， 功耗越低。

##### （2）实网信号强度
    终端的4G信号强度越好， 说明跟基站通信越容易。
    
    因此终端就不需要用特别大的功率和基站通信，因此功耗就会比较低。

    信号强度越差， 终端就需要用比较大的功率和基站通信，发射的功耗就会上升很多。

    本文的测试数据， 是基于信号强度良好的情况下测试出来的，
    
    这符合中国的4G信号的普遍情况。

    如果你的设备是在地下室，偏远地区这些信号比较弱的场景， 
    
    那么实际的设备的功耗，会上升一些。

##### （3）网络配置的 DRX 参数
    在终端注册到4G网络后，网络会根据网络自身的负载情况，下发一个DRX参数。
    
    这个DRX参数的大概意思是，终端多长时间醒过来去查询一下无线信道，
    
    看看网络有没有发什么通知给到终端。
    
    DRX 参数越小，代表终端就会更频繁的去查询是否有网络来的通知，功耗就会越大。

    DRX 参数是网络配置的，终端无法控制。
    
    所以，我们就分别测试了所有的三种 DRX 参数的功耗，让大家有个基本的认识。

    DRX 的三个参数分别为： 0.64秒，1.28秒，2.56秒，
    
    下文分别记为 快速监听，中速监听，慢速监听。
    
    这是我们自己发明的词汇，其他地方看不到，只是作为一个称谓，没有其他的含义。


##### （4）终端注册到4G的不同频段。
    国内的4G网络，有如下几个：
   
    B1，B3，B5，B8，B34，B38，B39，B40，B41。
   
    终端会根据信号强度的不同，选择一个信号最好的频段去驻留。
   
    本文给出的数据， 是终端驻留到 B3 的数据。
   
    其他的频段的功耗数据会略有差异，对于小数据量通信的场景，差异不会很大。


#### 3，TCP心跳5分钟的功耗数据

    以下的数据， 都是按照快速监听，中速监听，慢速监听的三个数据的次序来排列。

##### （1）780EPS
    0.73 毫安，  0.56 毫安，0.33 毫安；
     转换成毫瓦为：
    2.77 毫瓦，  2.13毫瓦，  1.25毫瓦；

##### （2）780EP
    0.88 毫安，  0.52 毫安，0.38 毫安；
    3.34 毫瓦，  1.98毫瓦，  1.44毫瓦；

##### （3）780E和780EX
    0.96 毫安，  0.59 毫安，0.46 毫安；
    3.65 毫瓦，  2.24毫瓦，  1.75毫瓦；

##### （4）780EQ，700ECQ，700EAQ，700EMQ，780EEN，700EEU
    1.07毫安，   0.93毫安， 0.51毫安。
    4.07 毫瓦，  3.53毫瓦，  1.94毫瓦；



#### 4，TCP心跳1分钟的功耗数据
    以下的数据， 都是按照快速监听，中速监听，慢速监听的三个数据的次序来排列。

##### （1）780EPS
    1.32 毫安，  1.07 毫安，0.82 毫安；
     转换成毫瓦为：
    5.02 毫瓦，  4.07毫瓦，  3.12毫瓦；

##### （2）780EP
    1,73 毫安，  1.38 毫安，1.06 毫安；
    6.57 毫瓦，  5.24毫瓦，  4.03毫瓦；

##### （3）780E和780EX
    1.76 毫安，  1.54 毫安，0.86 毫安；
    6.69 毫瓦，  5.85毫瓦，  3.27毫瓦；

##### （4）780EQ，700ECQ，700EAQ，700EMQ，780EEN，700EEU
    1.65毫安，   1.62毫安， 1.00毫安。
    6.27 毫瓦，  6.16毫瓦， 3.80毫瓦；


### （二）长时间休眠低频次唤醒的功耗

   在某些场景下，模组绝大多数时间深度休眠状态， 几个小时醒过来一次，
   
   向服务器端发送报文，然后继续深度休眠。

   由于不存在TCP链接， 所以服务器端无法主动向终端发送消息。

   服务器只能等待终端主动通信， 再通过回复消息，对终端做控制和参数配置。

   所以无法实现对终端的实时控制。

   这时候，模组的平均功耗，是非常低的，只有几个微安。


#### 1，测试条件

    - 1， 供电电压：      3.8V；
    - 2， IO电平设置：   1.8V；
    - 3， 固件版本： 截止到2024年9月30日的最新LuatOS固件；
    - 4， 测试服务器：    airtest.openluat.com, "2901"，回环测试；
    - 5， 每次终端醒来通信的内容：  
         10字节字符串： "0123456789"，    循环10次，一共 100字节；
    - 6，  驻网频段与驻网小区ID：   B3频段，小区id：  153708387；
        其他频段的功耗，会略有差异，但是对于小数据量的传输场景来说，差异不会特别的大。
    - 7，  UART1串口波特率：         9600；
    - 8，  信号强度：         实网环境， RSRP[-86，-88]之间；
    - 9， 测试硬件：    合宙Air780E/Air780EQ/Air780EP/Air780EPS/Air700ECQ，通用全IO开发板，2.1版本。
          删除了可能产生耗电的外设，比如 LED状态灯。
 

#### 2，影响实网功耗的主要网络因素

在非实时在线，深度休眠，定时醒来通信的通信场景下，影响功耗的因素，按照影响力从大到小排序， 分别是：

##### （1）定时醒来的间隔时间

    深度休眠的功耗非常低，只有几个微安。

    醒来通信的功耗相比深度休眠，功耗高了至少百倍。

    所以，醒过来的频次越低，总体功耗就越低。

    醒来的频次越高， 总体功耗就越高。


##### （2）实网信号强度
    终端的4G信号强度越好， 说明跟基站通信越容易。
    
    因此终端就不需要用特别大的功率和基站通信，因此功耗就会比较低。

    信号强度越差， 终端就需要用比较大的功率和基站通信，发射的功耗就会上升很多。

    本文的测试数据， 是基于信号强度良好的情况下测试出来的，
    
    这符合中国的4G信号的普遍情况。

    如果你的设备是在地下室，偏远地区这些信号比较弱的场景， 
    
    那么实际的设备的功耗，会上升一些。

    定时醒来的越频繁， 信号强度对功耗的影响越大；

    如果一天只醒来一次， 功耗的消耗主要是休眠的功耗消耗，信号强度对功耗的影响就没那么大了。


#### 3，各个模组的深度休眠定时醒来通信的功耗数据

    以下的数据，醒来发送数据的时间间隔按照 1小时，4小时，12，24小时的测试数据来呈现。

##### （1）780EPS
    34 微安，26 微安，7.5微安，5.86微安；
      转换成毫瓦为：
    130 微瓦， 99微瓦, 29微瓦，  22微瓦；

##### （2）780EP
    待测试；

##### （3）780E和780EX
    待测试；

##### （4）780EQ，700ECQ，700EAQ，700EMQ，780EEN，700EEU
    待测试；





